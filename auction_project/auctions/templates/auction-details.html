{% extends "base_light.html" %}

{% block title %}
Auction â€“ {{ auction.title }}
{% endblock %}

{% block content %}
<div class="main-card">

    <h1 class="text-center mb-3">
        <span>{{ auction.title }}</span>
    </h1>

    <p class="text-center text-muted mb-4">
        Created by
        <a href="{% url 'user-profile' auction.owner.pk %}">
            {{ auction.owner.username }}
        </a>
    </p>

    <div class="mb-4">
        <h3>Description</h3>
        <p>{{ auction.description }}</p>
    </div>

    <div class="row text-center mb-4">
        <div class="col-md-4 mb-2">
            <strong>Start price</strong><br>
            {{ auction.start_price }} $
        </div>

        <div class="col-md-4 mb-2">
            <strong>Current price</strong><br>
            {{ auction.current_price }} $
        </div>

        <div class="col-md-4 mb-2">
            <strong>Ends at</strong><br>
            {{ auction.end_time }}
        </div>
    </div>

    {% if user.is_authenticated and user != auction.owner and auction.is_active %}
        <div class="text-center mb-5">
            <a href="{% url 'bid-create' auction.pk %}"
               class="btn btn-info">
                Place a bid
            </a>
        </div>
    {% endif %}

    <h3 class="mb-4 text-center">Auction items</h3>

    {% if auction.items.all %}
        <div class="row g-4"> {% for item in auction.items.all %} <div class="col-md-6 col-lg-4">
            <div class="card h-100 text-light"
                 style=" background: rgba(255,255,255,0.07);
                 backdrop-filter: blur(8px); border-radius: 16px; border: 1px solid rgba(255,255,255,0.2); ">
                    {% if item.image %}
                <img src="{{ item.image.url }}" class="card-img-top" alt="{{ item.title }}"
                     style="height: 200px; object-fit: cover;">
                    {% endif %}
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title" style="color: darkblue">
                        {{ item.title }}
                    </h5>
                    <p class="card-text text-muted small mb-2">
                        Category: {{ item.category.title }} </p>
                    <p class="card-text flex-grow-1" style="font-size: 0.95rem; color: darkgrey;">
                        {{ item.description|truncatechars:90 }} </p>
                    <a href="{% url 'item-details' item.pk %}" class="btn btn-info mt-3 w-100">
                        View item
                    </a>
                </div>
            </div>
        </div>
            {% endfor %}
        </div>
    {% else %}
    <p class="text-center text-muted mt-4">
        No items in this auction yet.
    </p> {% endif %}


    <div class="d-flex justify-content-between align-items-center mt-5">
        <a href="{% url 'all-categories' %}"
           class="btn btn-outline-primary">
            Back
        </a>

        {% if user.is_authenticated and user == auction.owner %}
            <div>
                <a href="{% url 'auction-update' auction.pk %}"
                   class="btn btn-info me-2">
                    Edit
                </a>
            </div>
            <div>
                <form method="post" action="{% url 'auction-end' auction.pk %}">
                    {% csrf_token %}
                    <button class="btn btn-danger">
                        End now
                    </button>
                </form>
            </div>
            <div>
                <a href="{% url 'auction-delete' auction.pk %}"
                   class="btn btn-dark">
                    Delete
                </a>
            </div>
        {% endif %}
    </div>

</div>
{% endblock %}
